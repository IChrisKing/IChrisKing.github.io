<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>IChrisKing</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:type" content="website">
<meta property="og:title" content="IChrisKing">
<meta property="og:url" content="http://yoursite.com/page/3/index.html">
<meta property="og:site_name" content="IChrisKing">
<meta property="og:locale" content="zh-Hant-TW">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="IChrisKing">
  
    <link rel="alternate" href="/atom.xml" title="IChrisKing" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
  

</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">IChrisKing</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">#IMNOTCHRISLEE</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://yoursite.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-pattern-strategy" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/11/23/pattern-strategy/" class="article-date">
  <time datetime="2016-11-23T11:55:33.000Z" itemprop="datePublished">2016-11-23</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/设计模式/">设计模式</a>►<a class="article-category-link" href="/categories/设计模式/Java/">Java</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/11/23/pattern-strategy/">Android中的设计模式之策略模式</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>策略模式属于对象的行为模式。其用意是针对一组算法，将每一个算法封装到具有共同接口的独立的类中，从而使得它们可以相互替换。策略模式使得算法可以在不影响到客户端的情况下发生变化。</p>
<p>策略模式的结构<br>　　策略模式是对算法的包装，是把使用算法的责任和算法本身分割开来，委派给不同的对象管理。策略模式通常把一个系列的算法包装到一系列的策略类里面，作为一个抽象策略类的子类。用一句话来说，就是：“准备一组算法，并将每一个算法封装起来，使得它们可以互换”。</p>
<h3 id="策略模式的优点"><a href="#策略模式的优点" class="headerlink" title="策略模式的优点"></a>策略模式的优点</h3><p>　　（1）策略模式提供了管理相关的算法族的办法。策略类的等级结构定义了一个算法或行为族。恰当使用继承可以把公共的代码移到父类里面，从而避免代码重复。</p>
<p>　　（2）使用策略模式可以避免使用多重条件(if-else)语句。多重条件语句不易维护，它把采取哪一种算法或采取哪一种行为的逻辑与算法或行为的逻辑混合在一起，统统列在一个多重条件语句里面，比使用继承的办法还要原始和落后。</p>
<h3 id="策略模式的缺点"><a href="#策略模式的缺点" class="headerlink" title="策略模式的缺点"></a>策略模式的缺点</h3><p>　　（1）客户端必须知道所有的策略类，并自行决定使用哪一个策略类。这就意味着客户端必须理解这些算法的区别，以便适时选择恰当的算法类。换言之，策略模式只适用于客户端知道算法或行为的情况。</p>
<p>　　（2）由于策略模式把每个具体的策略实现都单独封装成为类，如果备选的策略很多的话，那么对象的数目就会很可观。</p>
<p><img src="/assets/img/strategy_pattern/strategy-pattern.png" alt="image"></p>
<p><a href="http://www.cnblogs.com/java-my-life/archive/2012/05/10/2491891.html" target="_blank" rel="external">源代码</a></p>
<p>这个模式涉及到三个角色：</p>
<p>　　●　　环境(Context)角色：持有一个Strategy的引用。</p>
<p>　　●　　抽象策略(Strategy)角色：这是一个抽象角色，通常由一个接口或抽象类实现。此角色给出所有的具体策略类所需的接口。</p>
<p>　　●　　具体策略(ConcreteStrategy)角色：包装了相关的算法或行为。</p>
<h2 id="Android中的策略模式"><a href="#Android中的策略模式" class="headerlink" title="Android中的策略模式"></a>Android中的策略模式</h2><p>在android中不同Animation动画的实现，主要是依靠Interpolator的不同而实现的。动画实现的流程，要先从View入手，而View一般不会单独存在，都是存在于某个ViewGroup中，所以Android动画绘制的地方选择了在ViewGroup中的drawChild(Canvas canvas, View child, long drawingTime)方法中进行调用子View的绘制。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">protected boolean drawChild(Canvas canvas, View child, long drawingTime) &#123;</div><div class="line">    return child.draw(canvas, this, drawingTime);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>再查看View中的draw方法：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">    boolean draw(Canvas canvas, ViewGroup parent, long drawingTime) &#123;</div><div class="line">        </div><div class="line">        .......</div><div class="line">//获取设置的动画信息</div><div class="line">        final Animation a = getAnimation();</div><div class="line">        if (a != null) &#123;</div><div class="line">        //绘制动画</div><div class="line">            more = applyLegacyAnimation(parent, drawingTime, a, scalingRequired);</div><div class="line">            concatMatrix = a.willChangeTransformationMatrix();</div><div class="line">            if (concatMatrix) &#123;</div><div class="line">                mPrivateFlags3 |= PFLAG3_VIEW_IS_ANIMATING_TRANSFORM;</div><div class="line">            &#125;</div><div class="line">            transformToApply = parent.getChildTransformation();</div><div class="line">        &#125; else &#123;</div><div class="line">        	......</div><div class="line">        &#125;</div><div class="line"></div><div class="line">......</div><div class="line">    &#125;</div></pre></td></tr></table></figure></p>
<p>查看applyLegacyAnimation方法：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div></pre></td><td class="code"><pre><div class="line">Transformation invalidationTransform;</div><div class="line">        final int flags = parent.mGroupFlags;</div><div class="line">        //动画是否已经初始化过</div><div class="line">        final boolean initialized = a.isInitialized();</div><div class="line">        if (!initialized) &#123;</div><div class="line">            a.initialize(mRight - mLeft, mBottom - mTop, parent.getWidth(), parent.getHeight());</div><div class="line">            a.initializeInvalidateRegion(0, 0, mRight - mLeft, mBottom - mTop);</div><div class="line">            if (mAttachInfo != null) a.setListenerHandler(mAttachInfo.mHandler);</div><div class="line">            onAnimationStart();</div><div class="line">        &#125;</div><div class="line"></div><div class="line">	//View是否需要进行缩放</div><div class="line">        final Transformation t = parent.getChildTransformation();</div><div class="line">        boolean more = a.getTransformation(drawingTime, t, 1f);</div><div class="line">        if (scalingRequired &amp;&amp; mAttachInfo.mApplicationScale != 1f) &#123;</div><div class="line">            if (parent.mInvalidationTransformation == null) &#123;</div><div class="line">                parent.mInvalidationTransformation = new Transformation();</div><div class="line">            &#125;</div><div class="line">            invalidationTransform = parent.mInvalidationTransformation;</div><div class="line">            a.getTransformation(drawingTime, invalidationTransform, 1f);</div><div class="line">        &#125; else &#123;</div><div class="line">            invalidationTransform = t;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        if (more) &#123;</div><div class="line">        	//根据具体实现，判断当前动画类型是否需要进行调整位置到小，然后刷新不同的区域</div><div class="line">            if (!a.willChangeBounds()) &#123;</div><div class="line">                .......</div><div class="line">            &#125; else &#123;</div><div class="line">            	  .....</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        return more;</div><div class="line">    &#125;</div></pre></td></tr></table></figure></p>
<p>其中主要的操作是动画始化、动画操作、界面刷新。动画的具体实现是调用了Animation中的getTransformation(long currentTime, Transformation outTransformation,float scale)方法。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">  public boolean getTransformation(long currentTime, Transformation outTransformation,</div><div class="line">          float scale) &#123;</div><div class="line">      mScaleFactor = scale;</div><div class="line">      return getTransformation(currentTime, outTransformation);</div><div class="line">  &#125;</div><div class="line">  </div><div class="line">  public boolean getTransformation(long currentTime, Transformation outTransformation) &#123;</div><div class="line">      .....</div><div class="line">//计算当前动画的时间点</div><div class="line">          final float interpolatedTime = mInterpolator.getInterpolation(normalizedTime);</div><div class="line">          //应用动画效果</div><div class="line">          applyTransformation(interpolatedTime, outTransformation);</div><div class="line">      &#125;</div><div class="line">......</div><div class="line">      return mMore;</div><div class="line">  &#125;</div></pre></td></tr></table></figure></p>
<p>根据上面一系列的分析，Android系统中在处理动画的时候会调用插值器中的getInterpolation(float input)方法来获取当前的时间点，依次来计算当前变化的情况。</p>
<p>Android中的插值器Interpolator，它的作用是根据时间流逝的百分比来计算出当前属性值改变的百分比，系统预置的有LinearInterpolator（线性插值器：匀速动画）、AccelerateDecelerateInterpolator（加速减速插值器：动画两头慢中间快）和DecelerateInterpolator（减速插值器：动画越来越慢）等。<br><img src="/assets/img/strategy_pattern/interpolator.png" alt="image"></p>
<p>查看INterpolator的定义：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">public interface Interpolator extends TimeInterpolator &#123;</div><div class="line">    // A new interface, TimeInterpolator, was introduced for the new android.animation</div><div class="line">    // package. This older Interpolator interface extends TimeInterpolator so that users of</div><div class="line">    // the new Animator-based animations can use either the old Interpolator implementations or</div><div class="line">    // new classes that implement TimeInterpolator directly.</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>它只是继承了TimeInterpolator，没有做任何改变，查看TimeInterpolator。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">public interface TimeInterpolator &#123;</div><div class="line"></div><div class="line">    /**</div><div class="line">     * Maps a value representing the elapsed fraction of an animation to a value that represents</div><div class="line">     * the interpolated fraction. This interpolated value is then multiplied by the change in</div><div class="line">     * value of an animation to derive the animated value at the current elapsed animation time.</div><div class="line">     *</div><div class="line">     * @param input A value between 0 and 1.0 indicating our current point</div><div class="line">     *        in the animation where 0 represents the start and 1.0 represents</div><div class="line">     *        the end</div><div class="line">     * @return The interpolation value. This value can be more than 1.0 for</div><div class="line">     *         interpolators which overshoot their targets, or less than 0 for</div><div class="line">     *         interpolators that undershoot their targets.</div><div class="line">     */</div><div class="line">    float getInterpolation(float input);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>只是定义了一个getInterpolation方法。</p>
<p>接下来查看不同的Interpolator是如何实现这个方法的。</p>
<h3 id="Accelerate-Interpolator"><a href="#Accelerate-Interpolator" class="headerlink" title="Accelerate    Interpolator"></a>Accelerate    Interpolator</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">public float getInterpolation(float input) &#123;</div><div class="line">    if (mFactor == 1.0f) &#123;</div><div class="line">        return input * input;</div><div class="line">    &#125; else &#123;</div><div class="line">        return (float)Math.pow(input, mDoubleFactor);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="CycleInterpolator"><a href="#CycleInterpolator" class="headerlink" title="CycleInterpolator"></a>CycleInterpolator</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">public float getInterpolation(float input) &#123;</div><div class="line">    return (float)(Math.sin(2 * mCycles * Math.PI * input));</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="LinearInterpolator"><a href="#LinearInterpolator" class="headerlink" title="LinearInterpolator"></a>LinearInterpolator</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">public float getInterpolation(float input) &#123;</div><div class="line">    return input;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2016/11/23/pattern-strategy/" data-id="cje6pjw2q005tweyxrkzv3ttn" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Java/">Java</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/设计模式/">设计模式</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-pattern-prototype" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/11/22/pattern-prototype/" class="article-date">
  <time datetime="2016-11-22T11:10:58.000Z" itemprop="datePublished">2016-11-22</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/设计模式/">设计模式</a>►<a class="article-category-link" href="/categories/设计模式/Java/">Java</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/11/22/pattern-prototype/">Android中的设计模式之原型模式</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>原型模式属于对象的创建模式。通过给出一个原型对象来指明所有创建的对象的类型，然后用复制这个原型对象的办法创建出更多同类型的对象。这就是选型模式的用意。</p>
<p>原型模式要求对象实现一个可以“克隆”自身的接口，这样就可以通过复制一个实例对象本身来创建一个新的实例。这样一来，通过原型实例创建新的对象，就不再需要关心这个实例本身的类型，只要实现了克隆自身的方法，就可以通过这个方法来获取新的对象，而无须再去通过new来创建。</p>
<h3 id="原型模式的优点"><a href="#原型模式的优点" class="headerlink" title="原型模式的优点"></a>原型模式的优点</h3><p>　　原型模式允许在运行时动态改变具体的实现类型。原型模式可以在运行期间，由客户来注册符合原型接口的实现类型，也可以动态地改变具体的实现类型，看起来接口没有任何变化，但其实运行的已经是另外一个类实例了。因为克隆一个原型就类似于实例化一个类。</p>
<h3 id="原型模式的缺点"><a href="#原型模式的缺点" class="headerlink" title="原型模式的缺点"></a>原型模式的缺点</h3><p>　　原型模式最主要的缺点是每一个类都必须配备一个克隆方法。配备克隆方法需要对类的功能进行通盘考虑，这对于全新的类来说不是很难，而对于已经有的类不一定很容易，特别是当一个类引用不支持序列化的间接对象，或者引用含有循环结构的时候。</p>
<p>　　原型模式有两种表现形式：（1）简单形式、（2）登记形式，这两种表现形式仅仅是原型模式的不同实现。<br><a href="http://www.cnblogs.com/java-my-life/archive/2012/04/11/2439387.html" target="_blank" rel="external">源码位置</a></p>
<h3 id="简单形式的原型模式"><a href="#简单形式的原型模式" class="headerlink" title="简单形式的原型模式"></a>简单形式的原型模式</h3><p><img src="/assets/img/prototype_pattern/simple.png" alt="image"><br>这种形式涉及到三个角色：</p>
<p>　　（1）客户(Client)角色：客户类提出创建对象的请求。</p>
<p>　　（2）抽象原型(Prototype)角色：这是一个抽象角色，通常由一个Java接口或Java抽象类实现。此角色给出所有的具体原型类所需的接口。</p>
<p>　　（3）具体原型（Concrete Prototype）角色：被复制的对象。此角色需要实现抽象的原型角色所要求的接口。</p>
<h3 id="登记形式的原型模式"><a href="#登记形式的原型模式" class="headerlink" title="登记形式的原型模式"></a>登记形式的原型模式</h3><p><img src="/assets/img/prototype_pattern/manager.png" alt="image"><br>它多了一个原型管理器(PrototypeManager)角色，该角色的作用是：创建具体原型类的对象，并记录每一个被创建的对象。</p>
<p>原型管理器角色保持一个聚集，作为对所有原型对象的登记，这个角色提供必要的方法，供外界增加新的原型对象和取得已经登记过的原型对象。</p>
<h3 id="两种形式的比较"><a href="#两种形式的比较" class="headerlink" title="两种形式的比较"></a>两种形式的比较</h3><p>　　简单形式和登记形式的原型模式各有其长处和短处。</p>
<p>　　如果需要创建的原型对象数目较少而且比较固定的话，可以采取第一种形式。在这种情况下，原型对象的引用可以由客户端自己保存。</p>
<p>　　如果要创建的原型对象数目不固定的话，可以采取第二种形式。在这种情况下，客户端不保存对原型对象的引用，这个任务被交给管理员对象。在复制一个原型对象之前，客户端可以查看管理员对象是否已经有一个满足要求的原型对象。如果有，可以直接从管理员类取得这个对象引用；如果没有，客户端就需要自行复制此原型对象。</p>
<h2 id="java中的克隆"><a href="#java中的克隆" class="headerlink" title="java中的克隆"></a>java中的克隆</h2><p>　　Java的所有类都是从java.lang.Object类继承而来的，而Object类提供protected Object clone()方法对对象进行复制，子类当然也可以把这个方法置换掉，提供满足自己需要的复制方法。对象的复制有一个基本问题，就是对象通常都有对其他的对象的引用。当使用Object类的clone()方法来复制一个对象时，此对象对其他对象的引用也同时会被复制一份</p>
<p>　　Java语言提供的Cloneable接口只起一个作用，就是在运行时期通知Java虚拟机可以安全地在这个类上使用clone()方法。通过调用这个clone()方法可以得到一个对象的复制。由于Object类本身并不实现Cloneable接口，因此如果所考虑的类没有实现Cloneable接口时，调用clone()方法会抛出CloneNotSupportedException异常。</p>
<h3 id="克隆满足的条件"><a href="#克隆满足的条件" class="headerlink" title="克隆满足的条件"></a>克隆满足的条件</h3><p>　　clone()方法将对象复制了一份并返还给调用者。所谓“复制”的含义与clone()方法是怎么实现的。一般而言，clone()方法满足以下的描述：</p>
<p>　　（1）对任何的对象x，都有：x.clone()!=x。换言之，克隆对象与原对象不是同一个对象。</p>
<p>　　（2）对任何的对象x，都有：x.clone().getClass() == x.getClass()，换言之，克隆对象与原对象的类型一样。</p>
<p>　　（3）如果对象x的equals()方法定义其恰当的话，那么x.clone().equals(x)应当成立的。</p>
<p>　　在JAVA语言的API中，凡是提供了clone()方法的类，都满足上面的这些条件。JAVA语言的设计师在设计自己的clone()方法时，也应当遵守着三个条件。一般来说，上面的三个条件中的前两个是必需的，而第三个是可选的。</p>
<h3 id="浅克隆"><a href="#浅克隆" class="headerlink" title="浅克隆"></a>浅克隆</h3><p>只负责克隆按值传递的数据（比如基本数据类型、String类型），而不复制它所引用的对象，换言之，所有的对其他对象的引用都仍然指向原来的对象。</p>
<h3 id="深克隆"><a href="#深克隆" class="headerlink" title="深克隆"></a>深克隆</h3><p>除了浅度克隆要克隆的值外，还负责克隆引用类型的数据。那些引用其他对象的变量将指向被复制过的新对象，而不再是原有的那些被引用的对象。换言之，深度克隆把要复制的对象所引用的对象都复制了一遍，而这种对被引用到的对象的复制叫做间接复制。</p>
<p>　　深度克隆要深入到多少层，是一个不易确定的问题。在决定以深度克隆的方式复制一个对象的时候，必须决定对间接复制的对象时采取浅度克隆还是继续采用深度克隆。因此，在采取深度克隆时，需要决定多深才算深。此外，在深度克隆的过程中，很可能会出现循环引用的问题，必须小心处理。</p>
<h4 id="利用序列化实现深度克隆"><a href="#利用序列化实现深度克隆" class="headerlink" title="利用序列化实现深度克隆"></a>利用序列化实现深度克隆</h4><p>　　把对象写到流里的过程是序列化(Serialization)过程；而把对象从流中读出来的过程则叫反序列化(Deserialization)过程。应当指出的是，写到流里的是对象的一个拷贝，而原对象仍然存在于JVM里面。</p>
<p>　　在Java语言里深度克隆一个对象，常常可以先使对象实现Serializable接口，然后把对象（实际上只是对象的拷贝）写到一个流里（序列化），再从流里读回来（反序列化），便可以重建对象。</p>
<p>这样做的前提就是对象以及对象内部所有引用到的对象都是可序列化的，否则，就需要仔细考察那些不可序列化的对象可否设成transient，从而将之排除在复制过程之外。</p>
<p>　　浅度克隆显然比深度克隆更容易实现，因为Java语言的所有类都会继承一个clone()方法，而这个clone()方法所做的正式浅度克隆。</p>
<p>　　有一些对象，比如线程(Thread)对象或Socket对象，是不能简单复制或共享的。不管是使用浅度克隆还是深度克隆，只要涉及这样的间接对象，就必须把间接对象设成transient而不予复制；或者由程序自行创建出相当的同种对象，权且当做复制件使用。</p>
<h2 id="Android中的原型模式"><a href="#Android中的原型模式" class="headerlink" title="Android中的原型模式"></a>Android中的原型模式</h2><p>Android中实现原型模式的例子非常多，很多的类都实现了clone()方法。有深克隆，也有浅克隆。</p>
<h3 id="Intent"><a href="#Intent" class="headerlink" title="Intent"></a>Intent</h3><p>/frameworks/base/core/java/android/content/Intent.java<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line">public Intent(Intent o) &#123;</div><div class="line">    this.mAction = o.mAction;</div><div class="line">    this.mData = o.mData;</div><div class="line">    this.mType = o.mType;</div><div class="line">    this.mPackage = o.mPackage;</div><div class="line">    this.mComponent = o.mComponent;</div><div class="line">    this.mFlags = o.mFlags;</div><div class="line">    this.mContentUserHint = o.mContentUserHint;</div><div class="line">    if (o.mCategories != null) &#123;</div><div class="line">        this.mCategories = new ArraySet&lt;String&gt;(o.mCategories);</div><div class="line">    &#125;</div><div class="line">    if (o.mExtras != null) &#123;</div><div class="line">        this.mExtras = new Bundle(o.mExtras);</div><div class="line">    &#125;</div><div class="line">    if (o.mSourceBounds != null) &#123;</div><div class="line">        this.mSourceBounds = new Rect(o.mSourceBounds);</div><div class="line">    &#125;</div><div class="line">    if (o.mSelector != null) &#123;</div><div class="line">        this.mSelector = new Intent(o.mSelector);</div><div class="line">    &#125;</div><div class="line">    if (o.mClipData != null) &#123;</div><div class="line">        this.mClipData = new ClipData(o.mClipData);</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">@Override</div><div class="line">public Object clone() &#123;</div><div class="line">    return new Intent(this);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>Intent的clone方法返回了一个新的Intent对象，查看Intent()方法的代码可以发现，这个克隆方法除了将原对象所有的值和引用直接赋给新对象之外，还将对象的引用对象也重新创建一遍赋给了新对象。所以，这是一个深克隆。</p>
<h3 id="Bundle"><a href="#Bundle" class="headerlink" title="Bundle"></a>Bundle</h3><p>frameworks/base/core/java/android/os/Bundle.java<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">public Object clone() &#123;</div><div class="line">    return new Bundle(this);</div><div class="line">&#125;</div><div class="line"></div><div class="line">    public Bundle(Bundle b) &#123;</div><div class="line">    super(b);</div><div class="line"></div><div class="line">    mHasFds = b.mHasFds;</div><div class="line">    mFdsKnown = b.mFdsKnown;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>这是一个浅拷贝。</p>
<h3 id="Transition"><a href="#Transition" class="headerlink" title="Transition"></a>Transition</h3><p>frameworks/base/core/java/android/transition/Transition.java<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">public Transition clone() &#123;</div><div class="line">    Transition clone = null;</div><div class="line">    try &#123;</div><div class="line">        clone = (Transition) super.clone();</div><div class="line">        clone.mAnimators = new ArrayList&lt;Animator&gt;();</div><div class="line">        clone.mStartValues = new TransitionValuesMaps();</div><div class="line">        clone.mEndValues = new TransitionValuesMaps();</div><div class="line">        clone.mStartValuesList = null;</div><div class="line">        clone.mEndValuesList = null;</div><div class="line">    &#125; catch (CloneNotSupportedException e) &#123;&#125;</div><div class="line"></div><div class="line">    return clone;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>这是一个深拷贝</p>
<h3 id="Notification"><a href="#Notification" class="headerlink" title="Notification"></a>Notification</h3><p>frameworks/base/core/java/android/app/Notification.java<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div></pre></td><td class="code"><pre><div class="line">public Notification clone() &#123;</div><div class="line">    Notification that = new Notification();</div><div class="line">    cloneInto(that, true);</div><div class="line">    return that;</div><div class="line">&#125;</div><div class="line"></div><div class="line">    public Notification()</div><div class="line">&#123;</div><div class="line">    this.when = System.currentTimeMillis();</div><div class="line">    this.priority = PRIORITY_DEFAULT;</div><div class="line">&#125;</div><div class="line"></div><div class="line">    public void cloneInto(Notification that, boolean heavy) &#123;</div><div class="line">    that.when = this.when;</div><div class="line">    that.mSmallIcon = this.mSmallIcon;</div><div class="line">    that.number = this.number;</div><div class="line"></div><div class="line">    // PendingIntents are global, so there&apos;s no reason (or way) to clone them.</div><div class="line">    that.contentIntent = this.contentIntent;</div><div class="line">    that.deleteIntent = this.deleteIntent;</div><div class="line">    that.fullScreenIntent = this.fullScreenIntent;</div><div class="line"></div><div class="line">    if (this.tickerText != null) &#123;</div><div class="line">        that.tickerText = this.tickerText.toString();</div><div class="line">    &#125;</div><div class="line">    if (heavy &amp;&amp; this.tickerView != null) &#123;</div><div class="line">        that.tickerView = this.tickerView.clone();</div><div class="line">    &#125;</div><div class="line">    if (heavy &amp;&amp; this.contentView != null) &#123;</div><div class="line">        that.contentView = this.contentView.clone();</div><div class="line">    &#125;</div><div class="line">    if (heavy &amp;&amp; this.mLargeIcon != null) &#123;</div><div class="line">        that.mLargeIcon = this.mLargeIcon;</div><div class="line">    &#125;</div><div class="line">    that.iconLevel = this.iconLevel;</div><div class="line">    that.sound = this.sound; // android.net.Uri is immutable</div><div class="line">    that.audioStreamType = this.audioStreamType;</div><div class="line">    if (this.audioAttributes != null) &#123;</div><div class="line">        that.audioAttributes = new AudioAttributes.Builder(this.audioAttributes).build();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    final long[] vibrate = this.vibrate;</div><div class="line">    if (vibrate != null) &#123;</div><div class="line">        final int N = vibrate.length;</div><div class="line">        final long[] vib = that.vibrate = new long[N];</div><div class="line">        System.arraycopy(vibrate, 0, vib, 0, N);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    that.ledARGB = this.ledARGB;</div><div class="line">    that.ledOnMS = this.ledOnMS;</div><div class="line">    that.ledOffMS = this.ledOffMS;</div><div class="line">    that.defaults = this.defaults;</div><div class="line"></div><div class="line">    that.flags = this.flags;</div><div class="line"></div><div class="line">    that.priority = this.priority;</div><div class="line"></div><div class="line">    that.category = this.category;</div><div class="line"></div><div class="line">    that.mGroupKey = this.mGroupKey;</div><div class="line"></div><div class="line">    that.mSortKey = this.mSortKey;</div><div class="line"></div><div class="line">    if (this.extras != null) &#123;</div><div class="line">        try &#123;</div><div class="line">            that.extras = new Bundle(this.extras);</div><div class="line">            // will unparcel</div><div class="line">            that.extras.size();</div><div class="line">        &#125; catch (BadParcelableException e) &#123;</div><div class="line">            Log.e(TAG, &quot;could not unparcel extras from notification: &quot; + this, e);</div><div class="line">            that.extras = null;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    if (this.actions != null) &#123;</div><div class="line">        that.actions = new Action[this.actions.length];</div><div class="line">        for(int i=0; i&lt;this.actions.length; i++) &#123;</div><div class="line">            that.actions[i] = this.actions[i].clone();</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    if (heavy &amp;&amp; this.bigContentView != null) &#123;</div><div class="line">        that.bigContentView = this.bigContentView.clone();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    if (heavy &amp;&amp; this.headsUpContentView != null) &#123;</div><div class="line">        that.headsUpContentView = this.headsUpContentView.clone();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    that.visibility = this.visibility;</div><div class="line"></div><div class="line">    if (this.publicVersion != null) &#123;</div><div class="line">        that.publicVersion = new Notification();</div><div class="line">        this.publicVersion.cloneInto(that.publicVersion, heavy);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    that.color = this.color;</div><div class="line"></div><div class="line">    if (!heavy) &#123;</div><div class="line">        that.lightenPayload(); // will clean out extras</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>这是一个可选的拷贝过程。cloneInto方法有一个参数boolean heavy，可以决定是深克隆还是浅克隆。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2016/11/22/pattern-prototype/" data-id="cje6pjw2p005pweyx48tvmjnr" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Java/">Java</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/设计模式/">设计模式</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-Search" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/11/21/Search/" class="article-date">
  <time datetime="2016-11-21T12:42:33.000Z" itemprop="datePublished">2016-11-21</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/算法/">算法</a>►<a class="article-category-link" href="/categories/算法/Java/">Java</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/11/21/Search/">各种查找算法</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="源码地址"><a href="#源码地址" class="headerlink" title="源码地址"></a>源码地址</h2><p><a href="https://github.com/IChrisKing/SortAndFind" target="_blank" rel="external">SortAndFind</a><br><code>git@github.com:IChrisKing/SortAndFind.git</code></p>
<h2 id="顺序查找"><a href="#顺序查找" class="headerlink" title="顺序查找"></a>顺序查找</h2><ul>
<li>需求</li>
</ul>
<p>在array中查找是否存在value，如果存在多个，返回value的所有位置。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line">public class SequelSearch &#123;</div><div class="line">	static int[] array;</div><div class="line">	static int value;</div><div class="line"></div><div class="line">	public static HashSet&lt;Integer&gt; searchInArray(int[] arr, int val)&#123;</div><div class="line">		array = arr;</div><div class="line">		value = val;</div><div class="line">		HashSet&lt;Integer&gt; result = sequelSearch();</div><div class="line">		return result;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	private static HashSet&lt;Integer&gt; sequelSearch() &#123;</div><div class="line">		// TODO Auto-generated method stub</div><div class="line">		HashSet&lt;Integer&gt; res = new HashSet&lt;Integer&gt;();</div><div class="line">		for(int i=0;i&lt;array.length;i++)&#123;</div><div class="line">			if(array[i] == value)&#123;</div><div class="line">				res.add(i);</div><div class="line">			&#125;</div><div class="line">		&#125;</div><div class="line">		return res;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="二分查找"><a href="#二分查找" class="headerlink" title="二分查找"></a>二分查找</h2><ul>
<li>需求</li>
</ul>
<p>在array中查找是否存在value，如果存在，返回位置，如果不存在，返回-1。</p>
<p>使用递归和递推两种方式实现。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div></pre></td><td class="code"><pre><div class="line">public class BinarySearch &#123;</div><div class="line"></div><div class="line">	static int[] array;</div><div class="line">	static int value;</div><div class="line">//	int mid;</div><div class="line">	</div><div class="line">	public static int searchInArray(int[] arr, int val)&#123;</div><div class="line">		array = arr;</div><div class="line">		value = val;</div><div class="line">		int result = binarySearch(0,array.length-1);</div><div class="line">		return result;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	//递归方式</div><div class="line">	private static int binarySearch(int low, int high) &#123;</div><div class="line">		// TODO Auto-generated method stub</div><div class="line">		int mid = (low + high)/2;</div><div class="line">		if(low&lt;=high)&#123;</div><div class="line">			if(array[mid] == value)&#123;</div><div class="line">				return mid;</div><div class="line">			&#125;else if(array[mid] &lt; value)&#123;</div><div class="line">				binarySearch(mid+1, high);</div><div class="line">			&#125;else&#123;</div><div class="line">				binarySearch(low, mid-1);</div><div class="line">			&#125;</div><div class="line">		&#125;</div><div class="line">		</div><div class="line">		return -1;</div><div class="line">	&#125;</div><div class="line">	</div><div class="line">	//递推方式</div><div class="line">	private static int binarySearch(int low, int high) &#123;</div><div class="line">		// TODO Auto-generated method stub</div><div class="line">		int mid = (low + high)/2;</div><div class="line">		while(low&lt;high)&#123;</div><div class="line">			if(array[mid] == value)&#123;</div><div class="line">				return mid;</div><div class="line">			&#125;else if(array[mid] &lt; value)&#123;</div><div class="line">				low = mid+1;</div><div class="line">			&#125;else&#123;</div><div class="line">				high = mid-1;</div><div class="line">			&#125;</div><div class="line">		&#125;</div><div class="line">		</div><div class="line">		return -1;</div><div class="line">	&#125;</div><div class="line">	</div><div class="line">&#125;</div></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2016/11/21/Search/" data-id="cje6pjw0j000dweyxr3r2mz3p" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Java/">Java</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/查找算法/">查找算法</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/算法/">算法</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-pattern-adapter" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/11/21/pattern-adapter/" class="article-date">
  <time datetime="2016-11-21T11:03:26.000Z" itemprop="datePublished">2016-11-21</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/设计模式/">设计模式</a>►<a class="article-category-link" href="/categories/设计模式/Java/">Java</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/11/21/pattern-adapter/">Android中的设计模式之适配器模式</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>适配器模式把一个类的接口变换成客户端所期待的另一种接口，从而使原本因接口不匹配而无法在一起工作的两个类能够在一起工作。</p>
<h3 id="模式中的角色"><a href="#模式中的角色" class="headerlink" title="模式中的角色"></a>模式中的角色</h3><p>需要适配的类（Adaptee）：需要适配的类。</p>
<p>适配器（Adapter）：通过包装一个需要适配的对象，把原接口转换成目标接口。</p>
<p>目标接口（Target）：客户所期待的接口。可以是具体的或抽象的类，也可以是接口。</p>
<h3 id="类的适配器模式"><a href="#类的适配器模式" class="headerlink" title="类的适配器模式"></a>类的适配器模式</h3><p>类的适配器模式把适配的类的API转换成为目标类的API。</p>
<p><img src="/assets/img/adapter_pattern/adapter_class.png" alt="image"><br>在上图中可以看出，Adaptee类并没有sampleOperation2()方法，而客户端则期待这个方法。为使客户端能够使用Adaptee类，提供一个中间环节，即类Adapter，把Adaptee的API与Target类的API衔接起来。Adapter与Adaptee是继承关系，这决定了这个适配器模式是类的：</p>
<p>　　模式所涉及的角色有：</p>
<p>　　●　　目标(Target)角色：这就是所期待得到的接口。注意：由于这里讨论的是类适配器模式，因此目标不可以是类。</p>
<p>　　●　　源(Adapee)角色：现在需要适配的接口。</p>
<p>　　●　　适配器(Adaper)角色：适配器类是本模式的核心。适配器把源接口转换成目标接口。显然，这一角色不可以是接口，而必须是具体类。</p>
<p><a href="http://www.cnblogs.com/java-my-life/archive/2012/04/13/2442795.html" target="_blank" rel="external">源代码</a></p>
<h3 id="对象的适配器模式"><a href="#对象的适配器模式" class="headerlink" title="对象的适配器模式"></a>对象的适配器模式</h3><p>与类的适配器模式一样，对象的适配器模式把被适配的类的API转换成为目标类的API，与类的适配器模式不同的是，对象的适配器模式不是使用继承关系连接到Adaptee类，而是使用委派关系连接到Adaptee类。</p>
<p><img src="/assets/img/adapter_pattern/adapter_object.png" alt="image"></p>
<p>　　从上图可以看出，Adaptee类并没有sampleOperation2()方法，而客户端则期待这个方法。为使客户端能够使用Adaptee类，需要提供一个包装(Wrapper)类Adapter。这个包装类包装了一个Adaptee的实例，从而此包装类能够把Adaptee的API与Target类的API衔接起来。Adapter与Adaptee是委派关系，这决定了适配器模式是对象的。</p>
<h3 id="缺省适配模式"><a href="#缺省适配模式" class="headerlink" title="缺省适配模式"></a>缺省适配模式</h3><p>在很多情况下，必须让一个具体类实现某一个接口，但是这个类又用不到接口所规定的所有的方法。通常的处理方法是，这个具体类要实现所有的方法，那些有用的方法要有实现，那些没有用的方法也要有空的、平庸的实现。</p>
<p>　　这些空的方法是一种浪费，有时也是一种混乱。除非看过这些空方法的代码，程序员可能会以为这些方法不是空的。即便他知道其中有一些方法是空的，也不一定知道哪些方法是空的，哪些方法不是空的，除非看过这些方法的源代码或是文档。</p>
<p>　　缺省适配模式可以很好的处理这一情况。可以设计一个抽象的适配器类实现接口，此抽象类要给接口所要求的每一种方法都提供一个空的方法。此抽象类可以使它的具体子类免于被迫实现空的方法。</p>
<p><img src="/assets/img/adapter_pattern/adapter_empty.png" alt="image"></p>
<p>可以看到，接口AbstractService要求定义三个方法，分别是serviceOperation1()、serviceOperation2()、serviceOperation3()；而抽象适配器类ServiceAdapter则为这三种方法都提供了平庸的实现。因此，任何继承自抽象类ServiceAdapter的具体类都可以选择它所需要的方法实现，而不必理会其他的不需要的方法。</p>
<p>　　适配器模式的用意是要改变源的接口，以便于目标接口相容。缺省适配的用意稍有不同，它是为了方便建立一个不平庸的适配器类而提供的一种平庸实现。</p>
<p>　　在任何时候，如果不准备实现一个接口的所有方法时，就可以使用“缺省适配模式”制造一个抽象类，给出所有方法的平庸的具体实现。这样，从这个抽象类再继承下去的子类就不必实现所有的方法了。</p>
<h2 id="Android中的适配器模式"><a href="#Android中的适配器模式" class="headerlink" title="Android中的适配器模式"></a>Android中的适配器模式</h2><p><img src="/assets/img/adapter_pattern/adapter_android.png" alt="image"><br>以ListView为例，它需要的目标接口就是ListAdapter，继承自Adapter，其中包含一些基本方法，getCount,getView,getItem，getItemId等。</p>
<p>数据源包括List<t>,Cursor等，为了兼容这些不同类型的数据源，需要定义不同的适配器：ArrayAdapter，CursorAdapter。这些adapter间接继承自ListAdapter，满足了ListView的需求。将数据以合适的方式提供给目标。</t></p>
<p>以ArrayAdapter为例，查看一下源代码：</p>
<h3 id="Adapter"><a href="#Adapter" class="headerlink" title="Adapter"></a>Adapter</h3><p>frameworks/base/core/java/android/widget/Adapter.java<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">public interface Adapter &#123;</div><div class="line">    .....</div><div class="line">    </div><div class="line">    int getCount();   </div><div class="line"></div><div class="line">    Object getItem(int position);</div><div class="line"></div><div class="line">    long getItemId(int position);</div><div class="line">    </div><div class="line">    .......</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h3 id="ListAdapter"><a href="#ListAdapter" class="headerlink" title="ListAdapter"></a>ListAdapter</h3><p>/frameworks/base/core/java/android/widget/ListAdapter.java<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">public interface ListAdapter extends Adapter &#123;</div><div class="line">......</div><div class="line">    boolean isEnabled(int position);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h3 id="BaseAdapter"><a href="#BaseAdapter" class="headerlink" title="BaseAdapter"></a>BaseAdapter</h3><p>/frameworks/base/core/java/android/widget/BaseAdapter.java<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">public abstract class BaseAdapter implements ListAdapter, SpinnerAdapter &#123;</div><div class="line">    ......</div><div class="line">    </div><div class="line">    public void notifyDataSetChanged() &#123;</div><div class="line">        mDataSetObservable.notifyChanged();</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    ......</div><div class="line">    </div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h3 id="ArrayAdapter"><a href="#ArrayAdapter" class="headerlink" title="ArrayAdapter"></a>ArrayAdapter</h3><p>/frameworks/base/core/java/android/widget/ArrayAdapter.java<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line">public class ArrayAdapter&lt;T&gt; extends BaseAdapter implements Filterable, ThemedSpinnerAdapter &#123;</div><div class="line">....</div><div class="line">private List&lt;T&gt; mObjects;</div><div class="line">.....</div><div class="line"></div><div class="line">    @Override</div><div class="line">    public void notifyDataSetChanged() &#123;</div><div class="line">        super.notifyDataSetChanged();</div><div class="line">        mNotifyOnChange = true;</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    .....</div><div class="line">    </div><div class="line">        public int getCount() &#123;</div><div class="line">        return mObjects.size();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    public T getItem(int position) &#123;</div><div class="line">        return mObjects.get(position);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    public long getItemId(int position) &#123;</div><div class="line">        return position;</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    ......</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2016/11/21/pattern-adapter/" data-id="cje6pjw27004mweyxjkztzwy5" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Java/">Java</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/设计模式/">设计模式</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-pattern-factory" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/11/17/pattern-factory/" class="article-date">
  <time datetime="2016-11-17T10:21:26.000Z" itemprop="datePublished">2016-11-17</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/设计模式/">设计模式</a>►<a class="article-category-link" href="/categories/设计模式/Java/">Java</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/11/17/pattern-factory/">Android中的设计模式之工厂模式系列</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>关于工厂模式，主要包括简单工厂模式，工厂方法模式，抽象工厂模式。</p>
<p>关于他们的定义和异同，可以查看下面三篇文章。</p>
<p><a href="http://www.cnblogs.com/java-my-life/archive/2012/03/22/2412308.html" target="_blank" rel="external">简单工厂模式</a></p>
<p><a href="http://www.cnblogs.com/java-my-life/archive/2012/03/25/2416227.html" target="_blank" rel="external">工厂方法模式</a></p>
<p><a href="http://www.cnblogs.com/java-my-life/archive/2012/03/28/2418836.html" target="_blank" rel="external">抽象工厂模式</a></p>
<h2 id="Android中的抽象工厂模式"><a href="#Android中的抽象工厂模式" class="headerlink" title="Android中的抽象工厂模式"></a>Android中的抽象工厂模式</h2><p>抽象工厂模式提供一个创建一系列相关或相互依赖对象的接口，而无需指定它们具体的类。 </p>
<p>就是把生产抽象成一个接口，每个实例类都对应一个工厂类（普通工厂只有一个工厂类），同时所有工厂类都继承这个生产接口。</p>
<p>Android中对抽象工厂模式的运用的典型例子就是对ThreadFactory这个接口类的实现。</p>
<p>工厂的抽象：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">public abstract interface ThreadFactory</div><div class="line">&#123;</div><div class="line">  public abstract Thread newThread(Runnable paramRunnable);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>产品的抽象：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">public abstract interface Runnable</div><div class="line">&#123;</div><div class="line">  public abstract void run();</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h3 id="AsyncTask工厂类的实现："><a href="#AsyncTask工厂类的实现：" class="headerlink" title="AsyncTask工厂类的实现："></a>AsyncTask工厂类的实现：</h3><p>frameworks/core/java/android/os/AsyncTask.java<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">private static final ThreadFactory sThreadFactory = new ThreadFactory() &#123;</div><div class="line">    private final AtomicInteger mCount = new AtomicInteger(1);</div><div class="line"></div><div class="line">    public Thread newThread(Runnable r) &#123;</div><div class="line">        return new Thread(r, &quot;AsyncTask #&quot; + mCount.getAndIncrement());</div><div class="line">    &#125;</div><div class="line">&#125;;</div></pre></td></tr></table></figure></p>
<h3 id="MultiTaskDealer工厂类的实现"><a href="#MultiTaskDealer工厂类的实现" class="headerlink" title="MultiTaskDealer工厂类的实现"></a>MultiTaskDealer工厂类的实现</h3><p>/frameworks/base/services/core/java/com/android/server/pm/MultiTaskDealer.java<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">ThreadFactory factory = new ThreadFactory()</div><div class="line">&#123;</div><div class="line">    private final AtomicInteger mCount = new AtomicInteger(1);</div><div class="line"></div><div class="line">    public Thread newThread(final Runnable r) &#123;</div><div class="line">        if (DEBUG_TASK) Log.d(TAG, &quot;create a new thread:&quot; + taskName);</div><div class="line">        return new Thread(r, taskName + &quot;-&quot; + mCount.getAndIncrement());</div><div class="line">    &#125;</div><div class="line">&#125;;</div></pre></td></tr></table></figure></p>
<h3 id="ActivityView工厂类的实现"><a href="#ActivityView工厂类的实现" class="headerlink" title="ActivityView工厂类的实现"></a>ActivityView工厂类的实现</h3><p>frameworks/base/core/java/android/app/ActivityView.java<br>``<br>    private static final ThreadFactory sThreadFactory = new ThreadFactory() {<br>        private final AtomicInteger mCount = new AtomicInteger(1);</p>
<pre><code>    public Thread newThread(Runnable r) {
        return new Thread(r, &quot;ActivityView #&quot; + mCount.getAndIncrement());
    }
};
</code></pre><p>```</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2016/11/17/pattern-factory/" data-id="cje6pjw2c0051weyx8vm6fl1q" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Java/">Java</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/设计模式/">设计模式</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-pattern-flyweight" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/11/10/pattern-flyweight/" class="article-date">
  <time datetime="2016-11-10T02:52:58.000Z" itemprop="datePublished">2016-11-10</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/设计模式/">设计模式</a>►<a class="article-category-link" href="/categories/设计模式/Java/">Java</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/11/10/pattern-flyweight/">Android中的设计模式之享元模式</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>享元模式是对象的结构模式。享元模式以共享的方式高效地支持大量的细粒度对象。</p>
<p>在JAVA语言中，String类型就是使用了享元模式。String对象是final类型，对象一旦创建就不可改变。在JAVA中字符串常量都是存在常量池中的，JAVA会确保一个字符串常量在常量池中只有一个拷贝。</p>
<p>享元模式采用一个共享来避免大量拥有相同内容对象的开销。这种开销最常见、最直观的就是内存的损耗。享元对象能做到共享的关键是区分内蕴状态(Internal State)和外蕴状态(External State)。</p>
<p>　　一个内蕴状态是存储在享元对象内部的，并且是不会随环境的改变而有所不同。因此，一个享元可以具有内蕴状态并可以共享。</p>
<p>　　一个外蕴状态是随环境的改变而改变的、不可以共享的。享元对象的外蕴状态必须由客户端保存，并在享元对象被创建之后，在需要使用的时候再传入到享元对象内部。外蕴状态不可以影响享元对象的内蕴状态，它们是相互独立的。</p>
<h3 id="单纯享元模式"><a href="#单纯享元模式" class="headerlink" title="单纯享元模式"></a>单纯享元模式</h3><p>　在单纯的享元模式中，所有的享元对象都是可以共享的。<br><img src="/assets/img/flyweight_pattern/simple.png" alt="image"><br>　　单纯享元模式所涉及到的角色如下：</p>
<p>　　●　　抽象享元(Flyweight)角色 ：给出一个抽象接口，以规定出所有具体享元角色需要实现的方法。</p>
<p>　　●　　具体享元(ConcreteFlyweight)角色：实现抽象享元角色所规定出的接口。如果有内蕴状态的话，必须负责为内蕴状态提供存储空间。</p>
<p>　　●　　享元工厂(FlyweightFactory)角色 ：本角色负责创建和管理享元角色。本角色必须保证享元对象可以被系统适当地共享。当一个客户端对象调用一个享元对象的时候，享元工厂角色会检查系统中是否已经有一个符合要求的享元对象。如果已经有了，享元工厂角色就应当提供这个已有的享元对象；如果系统中没有一个适当的享元对象的话，享元工厂角色就应当创建一个合适的享元对象。</p>
<p><a href="http://www.cnblogs.com/java-my-life/archive/2012/04/26/2468499.html" target="_blank" rel="external">源码查看</a></p>
<h3 id="复合享元模式"><a href="#复合享元模式" class="headerlink" title="复合享元模式"></a>复合享元模式</h3><p>在单纯享元模式中，所有的享元对象都是单纯享元对象，也就是说都是可以直接共享的。还有一种较为复杂的情况，将一些单纯享元使用合成模式加以复合，形成复合享元对象。这样的复合享元对象本身不能共享，但是它们可以分解成单纯享元对象，而后者则可以共享。<br><img src="/assets/img/flyweight_pattern/complex.png" alt="image"><br>复合享元角色所涉及到的角色如下：</p>
<p>　　●　　抽象享元(Flyweight)角色 ：给出一个抽象接口，以规定出所有具体享元角色需要实现的方法。</p>
<p>　　●　　具体享元(ConcreteFlyweight)角色：实现抽象享元角色所规定出的接口。如果有内蕴状态的话，必须负责为内蕴状态提供存储空间。</p>
<p>　　●　  复合享元(ConcreteCompositeFlyweight)角色 ：复合享元角色所代表的对象是不可以共享的，但是一个复合享元对象可以分解成为多个本身是单纯享元对象的组合。复合享元角色又称作不可共享的享元对象。</p>
<p>　　●　  享元工厂(FlyweightFactory)角色 ：本角 色负责创建和管理享元角色。本角色必须保证享元对象可以被系统适当地共享。当一个客户端对象调用一个享元对象的时候，享元工厂角色会检查系统中是否已经有 一个符合要求的享元对象。如果已经有了，享元工厂角色就应当提供这个已有的享元对象；如果系统中没有一个适当的享元对象的话，享元工厂角色就应当创建一个 合适的享元对象。</p>
<h3 id="享元的优缺点"><a href="#享元的优缺点" class="headerlink" title="享元的优缺点"></a>享元的优缺点</h3><p>享元模式的优缺点<br>　　享元模式的优点在于它大幅度地降低内存中对象的数量。但是，它做到这一点所付出的代价也是很高的：</p>
<p>　　●　　享元模式使得系统更加复杂。为了使对象可以共享，需要将一些状态外部化，这使得程序的逻辑复杂化。</p>
<p>　　●　　享元模式将享元对象的状态外部化，而读取外部状态使得运行时间稍微变长。</p>
<h2 id="Android中的享元模式"><a href="#Android中的享元模式" class="headerlink" title="Android中的享元模式"></a>Android中的享元模式</h2><p>享元模式是一种针对大量细粒度对象有效使用的一种模式。享元模式在Android中的运用过程中明显剥离和简化了享元工厂这一部分。主要突出的是享元对对象复用的特点。</p>
<p>Android中的Message、Parcel和TypedArray都利用了享元模式。以Message为例，Message中的obtain方法和recycle方法共同维护一个message Pool实现了message对象的复用。</p>
<p>Message通过next成员变量保有对下一个Message的引用，从而构成了一个Message链表。Message Pool就通过该链表的表头管理着所有闲置的Message，一个Message在使用完后可以通过recycle()方法进入Message Pool，并在需要时通过obtain静态方法从Message Pool获取。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div></pre></td><td class="code"><pre><div class="line">public static Message obtain() &#123;</div><div class="line">        synchronized (sPoolSync) &#123;</div><div class="line">            if (sPool != null) &#123;</div><div class="line">                Message m = sPool;</div><div class="line">                sPool = m.next;</div><div class="line">                m.next = null;</div><div class="line">                m.flags = 0; // clear in-use flag</div><div class="line">                sPoolSize--;</div><div class="line">                return m;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        return new Message();</div><div class="line">    &#125;</div><div class="line"></div><div class="line"> void recycleUnchecked() &#123;</div><div class="line">        // Mark the message as in use while it remains in the recycled object pool.</div><div class="line">        // Clear out all other details.</div><div class="line">        flags = FLAG_IN_USE;</div><div class="line">        what = 0;</div><div class="line">        arg1 = 0;</div><div class="line">        arg2 = 0;</div><div class="line">        obj = null;</div><div class="line">        replyTo = null;</div><div class="line">        sendingUid = -1;</div><div class="line">        when = 0;</div><div class="line">        target = null;</div><div class="line">        callback = null;</div><div class="line">        data = null;</div><div class="line"></div><div class="line">        synchronized (sPoolSync) &#123;</div><div class="line">            if (sPoolSize &lt; MAX_POOL_SIZE) &#123;</div><div class="line">                next = sPool;</div><div class="line">                sPool = this;</div><div class="line">                sPoolSize++;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div></pre></td></tr></table></figure></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2016/11/10/pattern-flyweight/" data-id="cje6pjw2b004xweyxwjyx1r9x" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Java/">Java</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/设计模式/">设计模式</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-pattern-memento" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/11/09/pattern-memento/" class="article-date">
  <time datetime="2016-11-09T09:09:58.000Z" itemprop="datePublished">2016-11-09</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/设计模式/">设计模式</a>►<a class="article-category-link" href="/categories/设计模式/Java/">Java</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/11/09/pattern-memento/">Android中的设计模式之备忘录模式</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>备忘录模式又叫做快照模式(Snapshot Pattern)或Token模式，是对象的行为模式。</p>
<p>　　备忘录对象是一个用来存储另外一个对象内部状态的快照的对象。备忘录模式的用意是在不破坏封装的条件下，将一个对象的状态捕捉(Capture)住，并外部化，存储起来，从而可以在将来合适的时候把这个对象还原到存储起来的状态。备忘录模式常常与命令模式和迭代子模式一同使用。</p>
<p><img src="/assets/img/memento_pattern/memento.png" alt="image"><br>备忘录模式所涉及的角色有三个：备忘录(Memento)角色、发起人(Originator)角色、负责人(Caretaker)角色。</p>
<h3 id="备忘录-Memento-角色"><a href="#备忘录-Memento-角色" class="headerlink" title="备忘录(Memento)角色"></a>备忘录(Memento)角色</h3><p>　　备忘录角色又如下责任：</p>
<p>　　（1）将发起人（Originator）对象的内战状态存储起来。备忘录可以根据发起人对象的判断来决定存储多少发起人（Originator）对象的内部状态。</p>
<p>　　（2）备忘录可以保护其内容不被发起人（Originator）对象之外的任何对象所读取。</p>
<p>　　备忘录有两个等效的接口：</p>
<p>　　●　　窄接口：负责人（Caretaker）对象（和其他除发起人对象之外的任何对象）看到的是备忘录的窄接口(narrow interface)，这个窄接口只允许它把备忘录对象传给其他的对象。</p>
<p>　　●　　宽接口：与负责人对象看到的窄接口相反的是，发起人对象可以看到一个宽接口(wide interface)，这个宽接口允许它读取所有的数据，以便根据这些数据恢复这个发起人对象的内部状态。</p>
<h3 id="发起人（Originator）角色"><a href="#发起人（Originator）角色" class="headerlink" title="发起人（Originator）角色"></a>发起人（Originator）角色</h3><p>　　发起人角色有如下责任：</p>
<p>　　（1）创建一个含有当前的内部状态的备忘录对象。</p>
<p>　　（2）使用备忘录对象存储其内部状态。</p>
<h3 id="负责人（Caretaker）角色"><a href="#负责人（Caretaker）角色" class="headerlink" title="负责人（Caretaker）角色"></a>负责人（Caretaker）角色</h3><p>　　负责人角色有如下责任：</p>
<p>　　（1）负责保存备忘录对象。</p>
<p>　　（2）不检查备忘录对象的内容。</p>
<h2 id="白箱模式和黑箱模式"><a href="#白箱模式和黑箱模式" class="headerlink" title="白箱模式和黑箱模式"></a>白箱模式和黑箱模式</h2><p>代码查看：<a href="http://www.cnblogs.com/java-my-life/archive/2012/06/06/2534942.html" target="_blank" rel="external">http://www.cnblogs.com/java-my-life/archive/2012/06/06/2534942.html</a></p>
<h3 id="白箱模式"><a href="#白箱模式" class="headerlink" title="白箱模式"></a>白箱模式</h3><p>备忘录角色对任何对象都提供一个接口，即宽接口，备忘录角色的内部所存储的状态就对所有对象公开。因此这个实现又叫做“白箱实现”。</p>
<p>　　“白箱”实现将发起人角色的状态存储在一个大家都看得到的地方，因此是破坏封装性的。但是通过程序员自律，同样可以在一定程度上实现模式的大部分用意。因此白箱实现仍然是有意义的。<br><img src="/assets/img/memento_pattern/white.png" alt="image"></p>
<h3 id="黑箱模式"><a href="#黑箱模式" class="headerlink" title="黑箱模式"></a>黑箱模式</h3><p>　备忘录角色对发起人（Originator）角色对象提供一个宽接口，而为其他对象提供一个窄接口。这样的实现叫做“黑箱实现”。</p>
<p>　　在JAVA语言中，实现双重接口的办法就是将备忘录角色类设计成发起人角色类的内部成员类。</p>
<p>　　将Memento设成Originator类的内部类，从而将Memento对象封装在Originator里面；在外部提供一个标识接口MementoIF给Caretaker以及其他对象。这样，Originator类看到的是Menmento的所有接口，而Caretaker以及其他对象看到的仅仅是标识接口MementoIF所暴露出来的接口。<br><img src="/assets/img/memento_pattern/black.png" alt="image"></p>
<h2 id="Android中的备忘录模式"><a href="#Android中的备忘录模式" class="headerlink" title="Android中的备忘录模式"></a>Android中的备忘录模式</h2><p>在不破坏封装性的前提下，捕获一个对象的内部状态，并在该对象之外保存这个状态，这样以后就可以将该对象恢复到先前保存的状态。</p>
<p>Android中的Canvas是一个黑箱的备忘录模式。组织者，把原发器的状态State（全部或者部分状态，一般是变量的值），通过CreateMemento()方法保存起来，继续运行后，等待合适的时机，在通过SetMemento()方法可以再次恢复到之前的状态。在这个过程中，我们并没有对这些状态做任何的访问和设置，实际上这些状态都是私有的，对外是禁止访问的，我们只是通过Memento对象的两个最简单的方法就达到了这个效果。Memento经常写成Originator的内部类。</p>
<p>查看他的源码：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">public int save() &#123;</div><div class="line">    return native_save(mNativeCanvasWrapper, MATRIX_SAVE_FLAG | CLIP_SAVE_FLAG);</div><div class="line">&#125;</div><div class="line"></div><div class="line">public int save(@Saveflags int saveFlags) &#123;</div><div class="line">    return native_save(mNativeCanvasWrapper, saveFlags);</div><div class="line">&#125;</div><div class="line"></div><div class="line">    public void restore() &#123;</div><div class="line">    boolean throwOnUnderflow = !sCompatibilityRestore || !isHardwareAccelerated();</div><div class="line">    native_restore(mNativeCanvasWrapper, throwOnUnderflow);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>　　从上面的两个方法中，它们实现了自我状态的恢复，实际上我们只是执行了两个没有接触任何内部信息的方法，实际上这两个方法就是在操作我们看不到的这些内部状态信息。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2016/11/09/pattern-memento/" data-id="cje6pjw2d0055weyxe59u683b" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Java/">Java</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/设计模式/">设计模式</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-pattern-template-method" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/11/08/pattern-template-method/" class="article-date">
  <time datetime="2016-11-08T12:32:37.000Z" itemprop="datePublished">2016-11-08</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/设计模式/">设计模式</a>►<a class="article-category-link" href="/categories/设计模式/Java/">Java</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/11/08/pattern-template-method/">Android中的设计模式之模板方法模式</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>模板方法模式是类的行为模式。准备一个抽象类，将部分逻辑以具体方法以及具体构造函数的形式实现，然后声明一些抽象方法来迫使子类实现剩余的逻辑。不同的子类可以以不同的方式实现这些抽象方法，从而对剩余的逻辑有不同的实现。这就是模板方法模式的用意。</p>
<p>　模板模式的关键是：子类可以置换掉父类的可变部分，但是子类却不可以改变模板方法所代表的顶级逻辑。</p>
<p><img src="/assets/img/template_method_pattern/template_method.png" alt="image"><br>这里涉及到两个角色：</p>
<p>　　抽象模板(Abstract Template)角色有如下责任：</p>
<p>　　■　　定义了一个或多个抽象操作，以便让子类实现。这些抽象操作叫做基本操作，它们是一个顶级逻辑的组成步骤。</p>
<p>　　■　　定义并实现了一个模板方法。这个模板方法一般是一个具体方法，它给出了一个顶级逻辑的骨架，而逻辑的组成步骤在相应的抽象操作中，推迟到子类实现。顶级逻辑也有可能调用一些具体方法。</p>
<p>　　具体模板(Concrete Template)角色又如下责任：</p>
<p>　　■　　实现父类所定义的一个或多个抽象方法，它们是一个顶级逻辑的组成步骤。</p>
<p>　　■　　每一个抽象模板角色都可以有任意多个具体模板角色与之对应，而每一个具体模板角色都可以给出这些抽象方法（也就是顶级逻辑的组成步骤）的不同实现，从而使得顶级逻辑的实现各不相同。</p>
<p>代码实现参考：<a href="http://www.cnblogs.com/java-my-life/archive/2012/05/14/2495235.html" target="_blank" rel="external">《JAVA与模式》之模板方法模式</a></p>
<h3 id="模板方法模式中的方法"><a href="#模板方法模式中的方法" class="headerlink" title="模板方法模式中的方法"></a>模板方法模式中的方法</h3><p>　　模板方法中的方法可以分为两大类：模板方法和基本方法。</p>
<h4 id="模板方法"><a href="#模板方法" class="headerlink" title="模板方法"></a>模板方法</h4><p>　　一个模板方法是定义在抽象类中的，把基本操作方法组合在一起形成一个总算法或一个总行为的方法。</p>
<p>　　一个抽象类可以有任意多个模板方法，而不限于一个。每一个模板方法都可以调用任意多个具体方法。</p>
<h4 id="基本方法"><a href="#基本方法" class="headerlink" title="基本方法"></a>基本方法</h4><p>　　基本方法又可以分为三种：抽象方法(Abstract Method)、具体方法(Concrete Method)和钩子方法(Hook Method)。</p>
<p>　　●　　抽象方法：一个抽象方法由抽象类声明，由具体子类实现。在Java语言里抽象方法以abstract关键字标示。</p>
<p>　　●　　具体方法：一个具体方法由抽象类声明并实现，而子类并不实现或置换。</p>
<p>　　●　　钩子方法：一个钩子方法由抽象类声明并实现，而子类会加以扩展。通常抽象类给出的实现是一个空实现，作为方法的默认实现。</p>
<p>　　在上面的例子中，AbstractTemplate是一个抽象类，它带有三个方法。其中abstractMethod()是一个抽象方法，它由抽象类声明为抽象方法，并由子类实现；hookMethod()是一个钩子方法，它由抽象类声明并提供默认实现，并且由子类置换掉。concreteMethod()是一个具体方法，它由抽象类声明并实现。</p>
<ul>
<li><p>默认钩子方法<br>　　一个钩子方法常常由抽象类给出一个空实现作为此方法的默认实现。这种空的钩子方法叫做“Do Nothing Hook”。显然，这种默认钩子方法在缺省适配模式里面已经见过了，一个缺省适配模式讲的是一个类为一个接口提供一个默认的空实现，从而使得缺省适配类的子类不必像实现接口那样必须给出所有方法的实现，因为通常一个具体类并不需要所有的方法。</p>
</li>
<li><p>命名规则<br>　　命名规则是设计师之间赖以沟通的管道之一，使用恰当的命名规则可以帮助不同设计师之间的沟通。</p>
</li>
</ul>
<p>　　钩子方法的名字应当以do开始，这是熟悉设计模式的Java开发人员的标准做法。在上面的例子中，钩子方法hookMethod()应当以do开头；在HttpServlet类中，也遵从这一命名规则，如doGet()、doPost()等方法。</p>
<h2 id="Android中的模板方法模式"><a href="#Android中的模板方法模式" class="headerlink" title="Android中的模板方法模式"></a>Android中的模板方法模式</h2><p><img src="/assets/img/template_method_pattern/view.jpg" alt="image"><br>以view为例，查看Android中的模板方法模式</p>
<h3 id="draw方法"><a href="#draw方法" class="headerlink" title="draw方法"></a>draw方法</h3><p>draw方法，就是一个典型的模板方法，它是一个具体方法，给出了一个顶级逻辑的骨架，而逻辑的组成步骤在相应的抽象操作中，推迟到子类实现。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div></pre></td><td class="code"><pre><div class="line">public void draw(Canvas canvas) &#123;</div><div class="line">       ...</div><div class="line"></div><div class="line">       /*</div><div class="line">        * Draw traversal performs several drawing steps which must be executed</div><div class="line">        * in the appropriate order:</div><div class="line">        *</div><div class="line">        *      1. Draw the background</div><div class="line">        *      2. If necessary, save the canvas&apos; layers to prepare for fading</div><div class="line">        *      3. Draw view&apos;s content</div><div class="line">        *      4. Draw children</div><div class="line">        *      5. If necessary, draw the fading edges and restore layers</div><div class="line">        *      6. Draw decorations (scrollbars for instance)</div><div class="line">        */</div><div class="line"></div><div class="line">       // Step 1, draw the background, if needed</div><div class="line">           ...</div><div class="line">           if (!dirtyOpaque) onDraw(canvas);</div><div class="line"></div><div class="line">           ...</div><div class="line">           dispatchDraw(canvas);</div><div class="line"></div><div class="line">           ...</div><div class="line">       &#125;</div><div class="line"></div><div class="line">       ...</div><div class="line">       </div><div class="line">       // Step 2, save the canvas&apos; layers</div><div class="line">       ...</div><div class="line">       // Step 3, draw the content</div><div class="line">       if (!dirtyOpaque) onDraw(canvas);</div><div class="line"></div><div class="line">       // Step 4, draw the children</div><div class="line">       dispatchDraw(canvas);</div><div class="line"></div><div class="line">       // Step 5, draw the fade effect and restore layers</div><div class="line">       ...</div><div class="line"></div><div class="line">       // Step 6, draw decorations (foreground, scrollbars)</div><div class="line">       onDrawForeground(canvas);</div><div class="line">   &#125;</div></pre></td></tr></table></figure></p>
<p>可以看到，在draw方法中调用了一些dispatchDraw和onDraw的方法，这些方法都是钩子方法。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">protected void onDraw(Canvas canvas) &#123;</div><div class="line">&#125;</div><div class="line"></div><div class="line">protected void dispatchDraw(Canvas canvas) &#123;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h3 id="layout方法："><a href="#layout方法：" class="headerlink" title="layout方法："></a>layout方法：</h3><p>layout方法也是一个模板方法。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">public void layout(int l, int t, int r, int b) &#123;</div><div class="line">            ...</div><div class="line">            onLayout(changed, l, t, r, b);</div><div class="line">            ...</div><div class="line">    &#125;</div></pre></td></tr></table></figure></p>
<p>layout方法中调用的onLayout也是一个钩子函数。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">protected void onLayout(boolean changed, int left, int top, int right, int bottom) &#123;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<ul>
<li>具体的实现，将在view的子类当中，例如<h3 id="TextView的实现"><a href="#TextView的实现" class="headerlink" title="TextView的实现"></a>TextView的实现</h3></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">@Override</div><div class="line">    protected void onDraw(Canvas canvas) &#123;</div><div class="line">	//省略具体实现代码</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    protected void onLayout(boolean changed, int left, int top, int right, int bottom) &#123;</div><div class="line">        super.onLayout(changed, left, top, right, bottom);</div><div class="line">        if (mDeferScroll &gt;= 0) &#123;</div><div class="line">            int curs = mDeferScroll;</div><div class="line">            mDeferScroll = -1;</div><div class="line">            bringPointIntoView(Math.min(curs, mText.length()));</div><div class="line">        &#125;</div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<h3 id="ListView"><a href="#ListView" class="headerlink" title="ListView"></a>ListView</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">@Override</div><div class="line">    protected void dispatchDraw(Canvas canvas) &#123;</div><div class="line">    //省略具体实现代码</div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<h3 id="ProgressBar"><a href="#ProgressBar" class="headerlink" title="ProgressBar"></a>ProgressBar</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">@Override</div><div class="line">protected synchronized void onDraw(Canvas canvas) &#123;</div><div class="line">    super.onDraw(canvas);</div><div class="line"></div><div class="line">    drawTrack(canvas);</div><div class="line">&#125;</div></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2016/11/08/pattern-template-method/" data-id="cje6pjw2r005wweyxzriuyvl5" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Java/">Java</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/设计模式/">设计模式</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-pattern-observer" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/11/07/pattern-observer/" class="article-date">
  <time datetime="2016-11-07T11:46:49.000Z" itemprop="datePublished">2016-11-07</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/设计模式/">设计模式</a>►<a class="article-category-link" href="/categories/设计模式/Java/">Java</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/11/07/pattern-observer/">Android中的设计模式之观察者模式</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>观察者模式是对象的行为模式，又叫发布-订阅(Publish/Subscribe)模式、模型-视图(Model/View)模式、源-监听器(Source/Listener)模式或从属者(Dependents)模式。</p>
<p>　　观察者模式定义了一种一对多的依赖关系，让多个观察者对象同时监听某一个主题对象。这个主题对象在状态上发生变化时，会通知所有观察者对象，使它们能够自动更新自己。</p>
<p><img src="/assets/img/observer_pattern/observer.png" alt="image"><br>观察者模式所涉及的角色有：</p>
<p>　　●　　抽象主题(Subject)角色：抽象主题角色把所有对观察者对象的引用保存在一个聚集（比如ArrayList对象）里，每个主题都可以有任何数量的观察者。抽象主题提供一个接口，可以增加和删除观察者对象，抽象主题角色又叫做抽象被观察者(Observable)角色。</p>
<p>　　●　　具体主题(ConcreteSubject)角色：将有关状态存入具体观察者对象；在具体主题的内部状态改变时，给所有登记过的观察者发出通知。具体主题角色又叫做具体被观察者(Concrete Observable)角色。</p>
<p>　　●　　抽象观察者(Observer)角色：为所有的具体观察者定义一个接口，在得到主题的通知时更新自己，这个接口叫做更新接口。</p>
<p>　　●　　具体观察者(ConcreteObserver)角色：存储与主题的状态自恰的状态。具体观察者角色实现抽象观察者角色所要求的更新接口，以便使本身的状态与主题的状态 像协调。如果需要，具体观察者角色可以保持一个指向具体主题对象的引用。</p>
<h3 id="推模式与拉模式"><a href="#推模式与拉模式" class="headerlink" title="推模式与拉模式"></a>推模式与拉模式</h3><p>关于观察者模式的推模式与拉模式，可以查看这篇文章<br><a href="http://www.cnblogs.com/java-my-life/archive/2012/05/16/2502279.html" target="_blank" rel="external">《JAVA与模式》之观察者模式</a></p>
<h2 id="Android中的观察者模式"><a href="#Android中的观察者模式" class="headerlink" title="Android中的观察者模式"></a>Android中的观察者模式</h2><p>Android中的观察者模式很多，比如view中各种控件的OnClickListener,OnLongClickListener等。</p>
<p>Content Observer<br><a href="http://blog.csdn.net/qinjuning/article/details/7047607" target="_blank" rel="external">Android中内容观察者的使用—- ContentObserver类详解</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2016/11/07/pattern-observer/" data-id="cje6pjw2f0059weyxn2uo52nu" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Java/">Java</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/设计模式/">设计模式</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-pattern-composite" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/11/04/pattern-composite/" class="article-date">
  <time datetime="2016-11-04T11:33:32.000Z" itemprop="datePublished">2016-11-04</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/设计模式/">设计模式</a>►<a class="article-category-link" href="/categories/设计模式/Java/">Java</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/11/04/pattern-composite/">Android中的设计模式之组合模式</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>合成模式属于结构模式，有时又叫做“部分——整体”模式或者合成模式。组合模式将对象组织到树结构中，可以用来描述整体与部分的关系。组合模式可以使客户端将单纯元素与复合元素同等看待。</p>
<p>文件系统是一个典型的组合模式。它是一个树形的结构，树的节点有两种：一种是树枝节点，即目录，目录中还有文件，也就是该节点还有子树。一种是树叶节点，即文件，没有子树。</p>
<p>显然，可以把目录和文件当做同一种对象同等对待和处理，这也就是合成模式的应用。</p>
<p>合成模式可以不提供父对象的管理方法，但是合成模式必须在合适的地方提供子对象的管理方法，诸如：add()、remove()、以及getChild()等。</p>
<p>合成模式的实现根据所实现接口的区别分为两种形式，分别称为安全式和透明式。</p>
<p>具体实现代码可参考<a href="http://www.cnblogs.com/java-my-life/archive/2012/04/17/2453861.html" target="_blank" rel="external">《JAVA与模式》之合成模式</a></p>
<h3 id="安全式"><a href="#安全式" class="headerlink" title="安全式"></a>安全式</h3><p>安全模式的合成模式要求管理聚集的方法只出现在树枝构件类中，而不出现在树叶构件类中。</p>
<p>安全式合成模式的缺点是不够透明，因为树叶类和树枝类将具有不同的接口.</p>
<p><img src="/assets/img/composite_pattern/safe.png" alt="image"><br>这种形式涉及到三个角色：</p>
<p>　　●　　抽象构件(Component)角色：这是一个抽象角色，它给参加组合的对象定义出公共的接口及其默认行为，可以用来管理所有的子对象。合成对象通常把它所包含的子对象当做类型为Component的对象。在安全式的合成模式里，构件角色并不定义出管理子对象的方法，这一定义由树枝构件对象给出。</p>
<p>　　●　　树叶构件(Leaf)角色：树叶对象是没有下级子对象的对象，定义出参加组合的原始对象的行为。</p>
<p>　　●　　树枝构件(Composite)角色：代表参加组合的有下级子对象的对象。树枝构件类给出所有的管理子对象的方法，如add()、remove()以及getChild()。</p>
<h3 id="透明模式"><a href="#透明模式" class="headerlink" title="透明模式"></a>透明模式</h3><p>透明式的合成模式要求所有的具体构件类，不论树枝构件还是树叶构件，均符合一个固定接口。</p>
<p>从客户端使用合成模式上，是否需要区分到底是“树枝对象”还是“树叶对象”。如果是透明的，那就不用区分，对于客户而言，都是Compoent对象，具体的类型对于客户端而言是透明的，是无须关心的。</p>
<p><img src="/assets/img/composite_pattern/transparent.png" alt="image"></p>
<h2 id="Android中的组合模式"><a href="#Android中的组合模式" class="headerlink" title="Android中的组合模式"></a>Android中的组合模式</h2><p>Android中的组合模式，最经典的就是View和ViewGroup类的使用。在android UI设计，几乎所有的widget和布局类都依靠这两个类。</p>
<p>View和ViewGroup类使用的时安全式的组合模式。<br><img src="/assets/img/composite_pattern/android.jpg" alt="image"><br>上图是View和ViewGroup的大致架构。</p>
<p>可以看到，ViewGroup继承自View，作为树枝节点，它实现了addView(),removeView(),getChild(int)等管理聚集的方法。而Button这样的叶子节点则没有管理局及的方法（虽然Button不是直接继承自View，而是通过了TextView，间接继承自View）。这样的架构，正是安全式的组合模式。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2016/11/04/pattern-composite/" data-id="cje6pjw25004eweyxal33ihpg" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Java/">Java</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/设计模式/">设计模式</a></li></ul>

    </footer>
  </div>
  
</article>


  


  <nav id="page-nav">
    <a class="extend prev" rel="prev" href="/page/2/">&laquo; __('prev')</a><a class="page-number" href="/">1</a><a class="page-number" href="/page/2/">2</a><span class="page-number current">3</span><a class="page-number" href="/page/4/">4</a><a class="page-number" href="/page/5/">5</a><span class="space">&hellip;</span><a class="page-number" href="/page/8/">8</a><a class="extend next" rel="next" href="/page/4/">__('next') &raquo;</a>
  </nav>
</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Android/">Android</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Android/Android-everyday/">Android_everyday</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Android/Android开发工程师/">Android开发工程师</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/AndroidRom/">AndroidRom</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Anrom/">Anrom</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Anrom/rom7-0/">rom7.0</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/Java/">Java</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Java/Android开发工程师/">Android开发工程师</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/Linux/">Linux</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/SEAndroid/">SEAndroid</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/cjdns/">cjdns</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/cjdns/cjdns源码分析/">cjdns源码分析</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/cjdns-cjdns源码分析/">cjdns - cjdns源码分析</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/hexo/">hexo</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/music/">music</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/net/">net</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/net/iptables/">iptables</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/树莓派/">树莓派</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/树莓派/配置/">配置</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/算法/">算法</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/算法/Java/">Java</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/设计模式/">设计模式</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/设计模式/Java/">Java</a></li></ul></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Android/">Android</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Android-everyday/">Android_everyday</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Android开发工程师/">Android开发工程师</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Anrom/">Anrom</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/C-C/">C/C++</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Java/">Java</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Linux/">Linux</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SEAndroid/">SEAndroid</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SELinux/">SELinux</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/cjdns/">cjdns</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/cjdns源码分析/">cjdns源码分析</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/git/">git</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/hexo/">hexo</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/iptables/">iptables</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/linux/">linux</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/music/">music</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/raspberry配置/">raspberry配置</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/rom/">rom</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/shadowsocks-vps/">shadowsocks/vps</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/tool/">tool</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/填坑/">填坑</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/排序算法/">排序算法</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/数据结构/">数据结构</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/查找算法/">查找算法</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/树莓派raspberry/">树莓派raspberry</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/算法/">算法</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/设计模式/">设计模式</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/Android/" style="font-size: 20px;">Android</a> <a href="/tags/Android-everyday/" style="font-size: 16.67px;">Android_everyday</a> <a href="/tags/Android开发工程师/" style="font-size: 15.56px;">Android开发工程师</a> <a href="/tags/Anrom/" style="font-size: 14.44px;">Anrom</a> <a href="/tags/C-C/" style="font-size: 14.44px;">C/C++</a> <a href="/tags/Java/" style="font-size: 18.89px;">Java</a> <a href="/tags/Linux/" style="font-size: 13.33px;">Linux</a> <a href="/tags/SEAndroid/" style="font-size: 10px;">SEAndroid</a> <a href="/tags/SELinux/" style="font-size: 10px;">SELinux</a> <a href="/tags/cjdns/" style="font-size: 14.44px;">cjdns</a> <a href="/tags/cjdns源码分析/" style="font-size: 14.44px;">cjdns源码分析</a> <a href="/tags/git/" style="font-size: 11.11px;">git</a> <a href="/tags/hexo/" style="font-size: 13.33px;">hexo</a> <a href="/tags/iptables/" style="font-size: 10px;">iptables</a> <a href="/tags/linux/" style="font-size: 10px;">linux</a> <a href="/tags/music/" style="font-size: 10px;">music</a> <a href="/tags/raspberry配置/" style="font-size: 10px;">raspberry配置</a> <a href="/tags/rom/" style="font-size: 10px;">rom</a> <a href="/tags/shadowsocks-vps/" style="font-size: 10px;">shadowsocks/vps</a> <a href="/tags/tool/" style="font-size: 11.11px;">tool</a> <a href="/tags/填坑/" style="font-size: 13.33px;">填坑</a> <a href="/tags/排序算法/" style="font-size: 11.11px;">排序算法</a> <a href="/tags/数据结构/" style="font-size: 10px;">数据结构</a> <a href="/tags/查找算法/" style="font-size: 11.11px;">查找算法</a> <a href="/tags/树莓派raspberry/" style="font-size: 11.11px;">树莓派raspberry</a> <a href="/tags/算法/" style="font-size: 12.22px;">算法</a> <a href="/tags/设计模式/" style="font-size: 17.78px;">设计模式</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/01/">January 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/12/">December 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/11/">November 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/09/">September 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/08/">August 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/07/">July 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/04/">April 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/03/">March 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/01/">January 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/12/">December 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/11/">November 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/10/">October 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/09/">September 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/08/">August 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/07/">July 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/06/">June 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/05/">May 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/03/">March 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/12/">December 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/06/">June 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/04/">April 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/02/">February 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/01/">January 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/03/">March 2014</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/02/">February 2014</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/06/">June 2013</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2018/01/29/cjnds-asymmetric-cryptography/">握手过程中，非对称密钥的应用</a>
          </li>
        
          <li>
            <a href="/2017/12/04/how-to-fix-rebase-still-in-progress/">如何解决报错“prior sync failed; rebase still in progress”</a>
          </li>
        
          <li>
            <a href="/2017/11/22/cjdns-3steps-lladdrsession/">使用SocketAddress来维护的EndpointsBySockaddr map机制中EndpointsBySockaddr session的建立过程</a>
          </li>
        
          <li>
            <a href="/2017/09/05/cjdns-cryptoauth/">cjdns源码分析--CryptoAuth</a>
          </li>
        
          <li>
            <a href="/2017/09/04/how-to-read-staff/">如何看懂五线谱</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2018 Chris King<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>

  </div>
</body>
</html>